version: '3.4'

services:
  account:
    image: personalassistant-account:latest
    container_name: personalassistant-account
    build:
      context: .
      dockerfile: src/Web/Account/Dockerfile
    depends_on:
      - postgres
      - rabbitmq

  gateway:
    image: personalassistant-gateway:latest
    container_name: personalassistant-gateway
    build:
      context: .
      dockerfile: src/Web/Gateway/Dockerfile
    depends_on:
      - core-api
      - todo-api
      - cooking-api
      - accountant-api
      - weatherman-api
      - trainer-api

  core-api:
    image: personalassistant-core-api:latest
    container_name: personalassistant-core-api
    build:
      context: .
      dockerfile: src/Web/Core.Api/Dockerfile
    depends_on:
      - postgres

  todo-api:
    image: personalassistant-todo-api:latest
    container_name: personalassistant-todo-api
    build:
      context: .
      dockerfile: src/Web/ToDoAssistant.Api/Dockerfile
    depends_on:
      - postgres
      - rabbitmq

  cooking-api:
    image: personalassistant-cooking-api:latest
    container_name: personalassistant-cooking-api
    build:
      context: .
      dockerfile: src/Web/CookingAssistant.Api/Dockerfile
    depends_on:
      - postgres
      - rabbitmq

  accountant-api:
    image: personalassistant-accountant-api:latest
    container_name: personalassistant-accountant-api
    build:
      context: .
      dockerfile: src/Web/Accountant.Api/Dockerfile
    depends_on:
      - postgres

  weatherman-api:
    image: personalassistant-weatherman-api:latest
    container_name: personalassistant-weatherman-api
    build:
      context: .
      dockerfile: src/Web/Weatherman.Api/Dockerfile
    depends_on:
      - postgres

  trainer-api:
    image: personalassistant-trainer-api:latest
    container_name: personalassistant-trainer-api
    build:
      context: .
      dockerfile: src/Web/Trainer.Api/Dockerfile
    depends_on:
      - postgres

  clientlogger:
    image: personalassistant-clientlogger:latest
    container_name: personalassistant-clientlogger
    build:
      context: .
      dockerfile: src/Web/ClientLogger/Dockerfile
    depends_on:
      - postgres
  
  sender:
    image: personalassistant-sender:latest
    container_name: personalassistant-sender
    build:
      context: .
      dockerfile: src/Background/Sender/Dockerfile
    depends_on:
      - postgres
      - rabbitmq

  postgres:
    image: postgres:12
    container_name: personalassistant-postgres
    restart: always

  rabbitmq:
    image: rabbitmq:3.8-management-alpine
    container_name: personal-assistant-rabbitmq
