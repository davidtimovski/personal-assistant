version: '3.4'

services:
  account:
    image: personalassistant-account:latest
    container_name: personalassistant-account
    build:
      context: .
      dockerfile: src/Account/Dockerfile
    depends_on:
      - postgres
      - rabbitmq

  api:
    image: personalassistant-api:latest
    container_name: personalassistant-api
    build:
      context: .
      dockerfile: src/Api/Dockerfile
    depends_on:
      - postgres
      - rabbitmq

  gateway:
    image: personalassistant-gateway:latest
    container_name: personalassistant-gateway
    build:
      context: .
      dockerfile: src/Gateway/Dockerfile
    depends_on:
      - core-api
      - todo-api
      - weatherman-api

  core-api:
    image: personalassistant-core-api:latest
    container_name: personalassistant-core-api
    build:
      context: .
      dockerfile: src/Core.Api/Dockerfile
    depends_on:
      - postgres

  todo-api:
    image: personalassistant-todo-api:latest
    container_name: personalassistant-todo-api
    build:
      context: .
      dockerfile: src/ToDoAssistant.Api/Dockerfile
    depends_on:
      - postgres
      - rabbitmq

  weatherman-api:
    image: personalassistant-weatherman-api:latest
    container_name: personalassistant-weatherman-api
    build:
      context: .
      dockerfile: src/Weatherman.Api/Dockerfile
    depends_on:
      - postgres

  clientlogger:
    image: personalassistant-clientlogger:latest
    container_name: personalassistant-clientlogger
    build:
      context: .
      dockerfile: src/ClientLogger/Dockerfile
    depends_on:
      - postgres
  
  sender:
    image: personalassistant-sender:latest
    container_name: personalassistant-sender
    build:
      context: .
      dockerfile: src/Sender/Dockerfile
    depends_on:
      - postgres
      - rabbitmq

  postgres:
    image: postgres:12
    container_name: personalassistant-postgres
    restart: always

  rabbitmq:
    image: rabbitmq:3.8-management-alpine
    container_name: personal-assistant-rabbitmq
